@model FoodHub.Models.Special

@{
    var pizzas = ViewBag.Pizzas as List<FoodHub.Models.Pizza> ?? new List<FoodHub.Models.Pizza>();
    var beverages = ViewBag.Beverages as List<FoodHub.Models.Beverage> ?? new List<FoodHub.Models.Beverage>();
    var index = 0;
}

<div class="card shadow-sm mb-4" style="max-width: 850px; margin:auto;">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Edit Special</h4>
    </div>

    <div class="card-body">
        <form asp-action="Edit" asp-controller="Specials" method="post" enctype="multipart/form-data">
            <input type="hidden" asp-for="Id" />

            <!-- BASIC INFO -->
            <div class="mb-3">
                <label asp-for="Title" class="form-label fw-bold"></label>
                <input asp-for="Title" class="form-control" placeholder="Enter title" />
                <span asp-validation-for="Title" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Description" class="form-label fw-bold"></label>
                <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter description"></textarea>
                <span asp-validation-for="Description" class="text-danger small"></span>
            </div>
          

            <!-- IMAGE -->
            <div class="mb-3 text-center">
                <label class="form-label fw-bold">Current Image</label><br />
                @if (!string.IsNullOrEmpty(Model.ImageName))
                {
                    <img src="~/uploads/specials/@Model.ImageName" alt="Special Image"
                         class="img-thumbnail mb-2" style="max-width: 250px;" />
                }
                else
                {
                    <div class="text-muted">No image uploaded</div>
                }
                <div class="mt-2">
                    <label class="form-label fw-bold">Upload New Image</label>
                    <input type="file" name="ImageFile" class="form-control" />
                </div>
            </div>

            <!-- SPECIAL ITEMS -->
            <div class="mb-4">
                <h5 class="fw-bold mb-3">Special Items</h5>
                <div id="special-items">
                    @if (Model.SpecialItems != null && Model.SpecialItems.Any())
                    {
                        foreach (var item in Model.SpecialItems)
                        {
                            <div class="row mb-2 item-row border rounded p-2" data-index="@index">
                                <input type="hidden" name="Items[@index].ItemType" value="@item.ItemType" />
                                <div class="col-md-5">
                                    <label class="fw-semibold">Item</label>
                                    <select name="Items[@index].ItemId" class="form-select item-id">
                                        @if (item.ItemType == "Pizza")
                                        {
                                            @foreach (var pizza in pizzas)
                                            {
                                                <option value="@pizza.Id" data-price="@pizza.BasePrice" selected="@(pizza.Id == item.ItemId)">
                                                    üçï @pizza.Name - Rs.@pizza.BasePrice
                                                </option>
                                            }
                                        }
                                        else if (item.ItemType == "Beverage")
                                        {
                                            @foreach (var bev in beverages)
                                            {
                                                <option value="@bev.Id" data-price="@bev.Price" selected="@(bev.Id == item.ItemId)">
                                                    ü•§ @bev.Name - Rs.@bev.Price
                                                </option>
                                            }
                                        }
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="fw-semibold">Quantity</label>
                                    <input type="number" name="Items[@index].Quantity" value="@item.Quantity" class="form-control item-qty" min="1" />
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <span class="fw-bold subtotal-text">Rs.0.00</span>
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="button" class="btn btn-danger btn-sm remove-item w-100">Remove</button>
                                </div>
                            </div>
                            index++;
                        }
                    }
                </div>

                <div class="mt-3">
                    <button type="button" id="add-item" class="btn btn-outline-primary btn-sm">+ Add Item</button>
                </div>
            </div>

             <!-- PRICE DETAILS -->
            <div class="row mb-3">
                <div class="col-md-3">
                    <label asp-for="TotalPrice" class="form-label fw-bold">Total Price (Rs)</label>
                    <input asp-for="TotalPrice" class="form-control" type="number" step="0.01" placeholder="0.00" readonly />
                </div>
                <div class="col-md-3">
                    <label asp-for="DiscountType" class="form-label fw-bold">Discount Type</label>
                    <select asp-for="DiscountType" class="form-select">
                        <option value="">Select Type</option>
                        <option value="Percentage" selected="@(Model.DiscountType == "Percentage")">Percentage</option>
                        <option value="Amount" selected="@(Model.DiscountType == "Amount")">Amount</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label asp-for="DiscountValue" class="form-label fw-bold">Discount Value</label>
                    <input asp-for="DiscountValue" class="form-control" type="number" step="0.01" placeholder="0.00" />
                </div>
                <div class="col-md-3">
                    <label asp-for="FinalPrice" class="form-label fw-bold">Final Price (Rs)</label>
                    <input asp-for="FinalPrice" class="form-control" type="number" step="0.01" placeholder="0.00" readonly />
                </div>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Update Special</button>
            </div>
            
         <div class="d-grid">
    <a href="/Admin/Dashboard?page=ViewSpecials" class="btn btn-primary btn-lg">
        ‚Üê Back to View Specials
    </a>
</div>




        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

  
}







@* @model FoodHub.Models.Special

@{
    var pizzas = ViewBag.Pizzas as List<FoodHub.Models.Pizza> ?? new List<FoodHub.Models.Pizza>();
    var beverages = ViewBag.Beverages as List<FoodHub.Models.Beverage> ?? new List<FoodHub.Models.Beverage>();
    var index = 0;
}

<div class="card shadow-sm mb-4" style="max-width: 850px; margin:auto;">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Edit Special</h4>
    </div>
    <div class="card-body">
        <form asp-action="Edit" asp-controller="Specials" method="post" enctype="multipart/form-data">
            <input type="hidden" asp-for="Id" />

            <!-- BASIC INFO -->
            <div class="mb-3">
                <label asp-for="Title" class="form-label fw-bold"></label>
                <input asp-for="Title" class="form-control" placeholder="Enter title" />
                <span asp-validation-for="Title" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Description" class="form-label fw-bold"></label>
                <textarea asp-for="Description" class="form-control" rows="3" placeholder="Enter description"></textarea>
                <span asp-validation-for="Description" class="text-danger small"></span>
            </div>

            <!-- PRICING & DISCOUNT -->
            <div class="row mb-3">
                <div class="col-md-3">
                    <label asp-for="TotalPrice" class="form-label fw-bold">Total Price (Rs)</label>
                    <input asp-for="TotalPrice" class="form-control" type="number" step="0.01" placeholder="0.00" />
                    <span asp-validation-for="TotalPrice" class="text-danger small"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="DiscountType" class="form-label fw-bold">Discount Type</label>
                    <select asp-for="DiscountType" class="form-select">
                        <option value="">Select Type</option>
                        <option value="Percentage" selected="@(Model.DiscountType == "Percentage")">Percentage</option>
                        <option value="Amount" selected="@(Model.DiscountType == "Amount")">Amount</option>
                    </select>
                    <span asp-validation-for="DiscountType" class="text-danger small"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="DiscountValue" class="form-label fw-bold">Discount Value</label>
                    <input asp-for="DiscountValue" class="form-control" type="number" step="0.01" placeholder="0.00" />
                    <span asp-validation-for="DiscountValue" class="text-danger small"></span>
                </div>
                <div class="col-md-3">
                    <label asp-for="FinalPrice" class="form-label fw-bold">Final Price (Rs)</label>
                    <input asp-for="FinalPrice" class="form-control" type="number" step="0.01" placeholder="0.00" readonly />
                    <span asp-validation-for="FinalPrice" class="text-danger small"></span>
                </div>
            </div>

            <!-- IMAGE SECTION -->
            <div class="mb-3 text-center">
                <label class="form-label fw-bold">Current Image</label><br />
                @if (!string.IsNullOrEmpty(Model.ImageName))
                {
                    <img src="~/uploads/specials/@Model.ImageName" alt="Special Image" 
                         class="img-thumbnail mb-2" style="max-width: 250px;" />
                }
                else
                {
                    <div class="text-muted">No image uploaded</div>
                }
                <div class="mt-2">
                    <label class="form-label fw-bold">Upload New Image</label>
                    <input type="file" name="ImageFile" class="form-control" />
                </div>
            </div>

            <!-- SPECIAL ITEMS -->
            <div class="mb-4">
                <h5 class="fw-bold mb-3">Special Items</h5>
                <div id="special-items">
                    @if (Model.SpecialItems != null && Model.SpecialItems.Any())
                    {
                        foreach (var item in Model.SpecialItems)
                        {
                            <div class="row mb-2 item-row border rounded p-2" data-index="@index">
                                <input type="hidden" name="Items[@index].ItemType" value="@item.ItemType" />
                                <div class="col-md-5">
                                    <label class="fw-semibold">Item</label>
                                    <select name="Items[@index].ItemId" class="form-select">
                                        @if (item.ItemType == "Pizza")
                                        {
                                            @foreach (var pizza in pizzas)
                                            {
                                                <option value="@pizza.Id" selected="@(pizza.Id == item.ItemId)">
                                                    üçï @pizza.Name
                                                </option>
                                            }
                                        }
                                        else if (item.ItemType == "Beverage")
                                        {
                                            @foreach (var bev in beverages)
                                            {
                                                <option value="@bev.Id" selected="@(bev.Id == item.ItemId)">
                                                    ü•§ @bev.Name
                                                </option>
                                            }
                                        }
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="fw-semibold">Quantity</label>
                                    <input type="number" name="Items[@index].Quantity" value="@item.Quantity" class="form-control" min="1" />
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="button" class="btn btn-danger btn-sm remove-item w-100">Remove</button>
                                </div>
                            </div>
                            index++;
                        }
                    }
                </div>

                <div class="mt-3">
                    <button type="button" id="add-item" class="btn btn-outline-primary btn-sm">+ Add Item</button>
                </div>
            </div>

            <!-- SUBMIT -->
            <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Update Special</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const addBtn = document.getElementById("add-item");
            const container = document.getElementById("special-items");
            let index = @Model.SpecialItems?.Count() ?? 0;

            addBtn.addEventListener("click", () => {
                const newRow = document.createElement("div");
                newRow.classList.add("row", "mb-2", "item-row", "border", "rounded", "p-2");
                newRow.dataset.index = index;

                newRow.innerHTML = `
                    <div class="col-md-4">
                        <label class="fw-semibold">Type</label>
                        <select name="Items[${index}].ItemType" class="form-select item-type">
                            <option value="">Select Type</option>
                            <option value="Pizza">Pizza</option>
                            <option value="Beverage">Beverage</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="fw-semibold">Item</label>
                        <select name="Items[${index}].ItemId" class="form-select item-id">
                            <option value="">Select Item</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="fw-semibold">Qty</label>
                        <input type="number" name="Items[${index}].Quantity" value="1" class="form-control" min="1" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="button" class="btn btn-danger btn-sm remove-item w-100">Remove</button>
                    </div>
                `;
                container.appendChild(newRow);
                index++;
            });

            container.addEventListener("click", e => {
                if (e.target.classList.contains("remove-item")) {
                    e.target.closest(".item-row").remove();
                }
            });

            // Populate items dynamically when type changes
            container.addEventListener("change", e => {
                if (e.target.classList.contains("item-type")) {
                    const type = e.target.value;
                    const itemSelect = e.target.closest(".item-row").querySelector(".item-id");
                    itemSelect.innerHTML = `<option value="">Select Item</option>`;

                    if (type === "Pizza") {
                        @foreach (var pizza in pizzas)
                        {
                            <text>
                                itemSelect.innerHTML += `<option value="@pizza.Id">üçï @pizza.Name</option>`;
                            </text>
                        }
                    } else if (type === "Beverage") {
                        @foreach (var bev in beverages)
                        {
                            <text>
                                itemSelect.innerHTML += `<option value="@bev.Id">ü•§ @bev.Name</option>`;
                            </text>
                        }
                    }
                }
            });

            // Optional: Live final price update
            const totalInput = document.querySelector("[name='TotalPrice']");
            const discountType = document.querySelector("[name='DiscountType']");
            const discountValue = document.querySelector("[name='DiscountValue']");
            const finalInput = document.querySelector("[name='FinalPrice']");

            function updateFinalPrice() {
                const total = parseFloat(totalInput.value) || 0;
                const discount = parseFloat(discountValue.value) || 0;
                let final = total;
                if (discountType.value === "Percentage") final = total - (total * discount / 100);
                else if (discountType.value === "Amount") final = total - discount;
                finalInput.value = final.toFixed(2);
            }

            [totalInput, discountType, discountValue].forEach(el => {
                el.addEventListener("input", updateFinalPrice);
                el.addEventListener("change", updateFinalPrice);
            });
        });
    </script>
} *@


@* @model FoodHub.Models.Special

@{
    var pizzas = ViewBag.Pizzas as List<FoodHub.Models.Pizza> ?? new List<FoodHub.Models.Pizza>();
    var beverages = ViewBag.Beverages as List<FoodHub.Models.Beverage> ?? new List<FoodHub.Models.Beverage>();
    var index = 0;
}

<div class="card shadow-sm mb-4" style="max-width: 800px; margin:auto;">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Edit Special</h4>
    </div>
    <div class="card-body">
        <form asp-action="Edit" asp-controller="Specials" method="post" enctype="multipart/form-data">
            <input type="hidden" asp-for="Id" />

            <!-- BASIC INFO -->
            <div class="mb-3">
                <label asp-for="Title" class="form-label fw-bold"></label>
                <input asp-for="Title" class="form-control" placeholder="Enter title" />
                <span asp-validation-for="Title" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Description" class="form-label fw-bold"></label>
                <textarea asp-for="Description" class="form-control" rows="4" placeholder="Enter description"></textarea>
                <span asp-validation-for="Description" class="text-danger small"></span>
            </div>

            <!-- CURRENT IMAGE -->
            <div class="mb-3 text-center">
                <label class="form-label fw-bold">Current Image</label><br />
                @if (!string.IsNullOrEmpty(Model.ImageName))
                {
                    <img src="~/uploads/specials/@Model.ImageName" alt="Special Image" 
                         class="img-thumbnail" style="max-width: 250px; height:auto;" />
                }
                else
                {
                    <div class="text-muted">No image uploaded</div>
                }
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Upload New Image</label>
                <input type="file" name="ImageFile" class="form-control" />
            </div>

            <!-- ITEMS LIST -->
            <div class="mb-4">
                <h5 class="fw-bold">Special Items</h5>
                <div id="special-items">
                    @if (Model.SpecialItems != null && Model.SpecialItems.Any())
                    {
                        foreach (var item in Model.SpecialItems)
                        {
                            <div class="row mb-2 item-row border rounded p-2" data-index="@index">
                                <input type="hidden" name="Items[@index].ItemType" value="@item.ItemType" />
                                <div class="col-md-5">
                                    <label class="fw-semibold">Item</label>
                                    <select name="Items[@index].ItemId" class="form-select">
                                        @if (item.ItemType == "Pizza")
                                        {
                                            @foreach (var pizza in pizzas)
                                            {
                                                <option value="@pizza.Id" selected="@(pizza.Id == item.ItemId)">
                                                    üçï @pizza.Name
                                                </option>
                                            }
                                        }
                                        else if (item.ItemType == "Beverage")
                                        {
                                            @foreach (var bev in beverages)
                                            {
                                                <option value="@bev.Id" selected="@(bev.Id == item.ItemId)">
                                                    ü•§ @bev.Name
                                                </option>
                                            }
                                        }
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="fw-semibold">Quantity</label>
                                    <input type="number" name="Items[@index].Quantity" value="@item.Quantity" class="form-control" min="1" />
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="button" class="btn btn-danger btn-sm remove-item w-100">Remove</button>
                                </div>
                            </div>
                            index++;
                        }
                    }
                </div>

                <div class="mt-3">
                    <button type="button" id="add-item" class="btn btn-outline-primary btn-sm">+ Add Item</button>
                </div>
            </div>

            <!-- SUBMIT -->
            <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Update Special</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const addBtn = document.getElementById("add-item");
            const container = document.getElementById("special-items");
            let index = @Model.SpecialItems?.Count() ?? 0;

            addBtn.addEventListener("click", () => {
                const newRow = document.createElement("div");
                newRow.classList.add("row", "mb-2", "item-row", "border", "rounded", "p-2");
                newRow.dataset.index = index;

                newRow.innerHTML = `
                    <div class="col-md-4">
                        <label class="fw-semibold">Type</label>
                        <select name="Items[${index}].ItemType" class="form-select item-type">
                            <option value="">Select Type</option>
                            <option value="Pizza">Pizza</option>
                            <option value="Beverage">Beverage</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="fw-semibold">Item</label>
                        <select name="Items[${index}].ItemId" class="form-select item-id">
                            <option value="">Select Item</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="fw-semibold">Qty</label>
                        <input type="number" name="Items[${index}].Quantity" value="1" class="form-control" min="1" />
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="button" class="btn btn-danger btn-sm remove-item w-100">Remove</button>
                    </div>
                `;

                container.appendChild(newRow);
                index++;
            });

            container.addEventListener("click", e => {
                if (e.target.classList.contains("remove-item")) {
                    e.target.closest(".item-row").remove();
                }
            });

            // Load items dynamically by type
            container.addEventListener("change", e => {
                if (e.target.classList.contains("item-type")) {
                    const type = e.target.value;
                    const itemSelect = e.target.closest(".item-row").querySelector(".item-id");
                    itemSelect.innerHTML = `<option value="">Select Item</option>`;

                    if (type === "Pizza") {
                        @foreach (var pizza in pizzas)
                        {
                            <text>
                                itemSelect.innerHTML += `<option value="@pizza.Id">üçï @pizza.Name</option>`;
                            </text>
                        }
                    } else if (type === "Beverage") {
                        @foreach (var bev in beverages)
                        {
                            <text>
                                itemSelect.innerHTML += `<option value="@bev.Id">ü•§ @bev.Name</option>`;
                            </text>
                        }
                    }
                }
            });
        });
    </script>
} *@


@* @model FoodHub.Models.Special

<div class="card shadow-sm mb-4" style="max-width: 600px; margin:auto;">
    <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Edit Special</h4>
    </div>
    <div class="card-body">
        <form asp-action="Edit" asp-controller="Specials" method="post" enctype="multipart/form-data">
            <input type="hidden" asp-for="Id" />

            <div class="mb-3">
                <label asp-for="Title" class="form-label fw-bold"></label>
                <input asp-for="Title" class="form-control form-control-lg" placeholder="Enter title" />
                <span asp-validation-for="Title" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Description" class="form-label fw-bold"></label>
                <textarea asp-for="Description" class="form-control form-control-lg" rows="4" placeholder="Enter description"></textarea>
                <span asp-validation-for="Description" class="text-danger small"></span>
            </div>

            <div class="mb-3 text-center">
                <label class="form-label fw-bold">Current Image</label><br />
                @if (!string.IsNullOrEmpty(Model.ImageName))
                {
                    <img src="~/uploads/specials/@Model.ImageName" alt="Special Image" 
                         class="img-thumbnail" style="max-width: 250px; height:auto;" />
                }
                else
                {
                    <div class="text-muted">No image uploaded</div>
                }
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">Upload New Image</label>
                <input type="file" name="ImageFile" class="form-control" />
                <span asp-validation-for="ImageName" class="text-danger small"></span>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Update Special</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
} *@
